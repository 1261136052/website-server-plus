define("wkapi:widget/js/reader/config/config.js",function(e,t,n){var r=e("wkapi:widget/js/dep/tangram/base.js"),o=e.data,p=o.get("WkInfo"),a=e("wkapi:widget/js/dep/mvp/template/template.js").template,i={zoomLevel:[],maxLoadPageNum:r.browser.ie&&r.browser.ie<8?3:5,retryCount:3,maxWaitingTime:3e3,proxyHost:"//wenku.baidu.com",proxyApi:"//wkretype.bdimg.com/retype/proxy.html",fontMapAPI:"//wkretype.bdimg.com/retype/font?font=ipad",fontMapLoaded:!1,fontMapping:{},readerContainerId:"reader-container-7",docVersion:4,samplingTexts:"1234567890ABCDEFGHIJKLMNabcdefghijklmn!@#$%^&&*()_+.\u4e00\u4e09\u4e94\u4e03\u4e5d\u8d30\u8086\u9646\u6252\u62fe\uff0c\u3002\u9752\u7389\u6848\u5143\u5915\u4e1c\u98ce\u591c\u653e\u82b1\u5343\u6811\u66f4\u5439\u843d\u661f\u5982\u96e8\u5b9d\u9a6c\u96d5\u8f66\u9999\u6ee1\u8def\u51e4\u7bab\u58f0\u52a8\u7389\u58f6\u5149\u8f6c\u4e00\u591c\u9c7c\u9f99\u821e\u86fe\u513f\u96ea\u67f3\u9ec4\u91d1\u7f15\u7b11\u8bed\u76c8\u76c8\u6697\u9999\u53bb\u4f17\u91cc\u5bfb\u4ed6\u5343\u767e\u5ea6\u66ae\u7136\u56de\u9996\u90a3\u4eba\u5374\u5728\u706f\u706b\u9611\u73ca\u5904 ",isPPT:!1,pptAPI:"//wenku.baidu.com/browse/getrequest?doc_id=<%=doc_id%>&pn=<%=pn%>&rn=<%=rn%>&type=ppt&token=<%=token%>&host=<%=host%>",pptStyle:{width:1080,height:810}},d=p.htmlBcs,c=d&&r.json.parse(p.htmlUrls);
i.loadAPI=function(e){var t=+e.pn,n=i.proxyHost+"/api/interface/getcontent?doc_id=<%=doc_id%>&pn=<%=pn%>&t=<%=t%>&v=<%=version%>&host=<%=host%>&token=<%=token%>&type=xreader",r=null;return{url:a(n,e),callbackName:r?["wenku",t].join("_"):["r",e.doc_id,t].join("_")}},i.fontAPI=function(e){var t="//wkretype.bdimg.com/retype/pipe",n=+e.pn,o="",p=e.hasOwnProperty("ff")?"&ff="+e.ff:"",a=r.url.jsonToQuery({pn:e.pn,t:e.t,rn:e.rn,v:e.v});return!d||(o=r.array.find(c.ttf,function(e){return e.pageIndex===n}),o=o?o.param:"")?t+"/"+e.doc_id+"?"+a+p+o+"&a=1":void 0
},i.picUrl=function(e){var t="//wkretype.bdimg.com/retype/pipe",n=+e.pn,o=null;return d&&(o=r.array.find(c.png,function(e){return e.pageIndex===n})),o?o.pageLoadUrl:t+"/"+e.doc_id+"?pn="+e.pn+"&rn=1&t=png&v="+e.version},function(){if(!d)return!1;var e=arguments,t=3e6,n=p.DocInfo.docId,a="/browse/getrequest?doc_id="+n+"&type=html&t="+ +new Date+"&rn=50&pn=";setTimeout(function(){r.ajax.get(a+o.get("readerStartPage"),function(t,n){n&&(c=r.json.parse(n),p.htmlUrls=n),e.callee()})},t)}(),n.exports.config=i
});
;define("wkapi:widget/js/reader/model/doc/model.js",function(e,t,n){var o,i=e("wkapi:widget/js/dep/tangram/base.js"),a=e("wkapi:widget/js/dep/mvp/model/model.js").ModelList,r=e("wkapi:widget/js/dep/mvp/template/template.js").template,s=e("wkapi:widget/js/dep/log/log.js"),d=e.data,c=d.get("WkInfo"),l=c.htmlBcs,p=function(e){var t="//gsp0.baidu.com/5aAHeD3nKhI2p27j8IqW0jdnxx1xbK/tb/pms/img/st.gif?p=112&b=40&mnt=0&d=";t+=i.json.stringify([{t:{load:+e},a:+l?6:5}]).replace('"',"%22"),Percent=window.Percent||{},(l&&Math.random()<=(Percent.htmlBcs||.1)||!l&&Math.random()<=(Percent.htmlPc||.1))&&((new Image).src=t)
};try{o=c.DocInfo.docType.toLowerCase()}catch(g){o="7"}var f=i.lang.createClass(function(e,t){this._init(e,t)},{superClass:a}).extend({unique_key:"page",_init:function(e,t){this.config=e,this.mediator=t,this._syncCache={},this._retryCounter={},this.mediator.on("m:getData",i.fn.bind(this.getData,this)),("7"===o||2!==+e.goodsType)&&this.mediator.on("m:getFont",i.fn.bind(this.getFont,this))},_sync:function(e){var t=this,n=this.config,a=n.doc_id_update,r=new Date,d=n.loadAPI({doc_id:a,version:n.readerVersion,t:"json",time:r.getTime(),pn:e,host:this.config.host,token:this.config.token}),c=d.url,g=this._retryCounter,f=this._syncCache,m=d.callbackName,u=u,h=function(a){var d=new Date-r;
if(a=a.data[1],a||a.body||s.send("view","jsonloaderror",{doc_id:n.doc_id,v:n.readerVersion,time:d,bcs:l,pn:e}),s.send("view","jsonload",{doc_id:n.doc_id,v:n.readerVersion,time:d,bcs:l,pn:e}),p(d),a.hasOwnProperty("errno")&&a.hasOwnProperty("errmsg"))return t.mediator.fire("p:error",{page:e,errmsg:a.errmsg,errno:0}),a=null,!1;if(t.mediator.fire("p:renderView",{data:{page:e,data:a,timeconsume:new Date-f[e]}}),delete g[e],"7"!==o&&2===+n.goodsType||!a.font){var c=i.dom.g("pageNo-"+e);c.style.opacity=1
}else t._preloadFontFile(a.font,e);a=null,window[m]=null};window[m]=function(e){clearTimeout(u),u=null,"7"!==o&&2===+n.goodsType||n.fontMapLoaded?h(e):u=setTimeout(function(){window[m](e)},10)},this._syncCache[e]||(this._syncCache[e]=+new Date,i.sio.callByServer(c,m,{timeOut:n.maxWaitingTime,onfailure:function(){!g[e]&&(g[e]=0),++g[e]<n.retryCount?setTimeout(function(){t._sync(e)},1):(s.send("view","jsonloaderror",{doc_id:n.doc_id,v:n.readerVersion,time:new Date-r,bcs:l,pn:e}),t.mediator.fire("p:error",{page:e,errmsg:"\u8bf7\u6c42\u8d85\u65f6",errno:0}),g[e]=0,delete t._syncCache[e])
},queryField:"callback"}))},getData:function(e){var t=this,n=e.pages;i.lang.isArray(n)||(n=[n]);for(var o=0,a=n.length;a>o;)t.config.isPPT?t._getPptData(n[o++]):t._sync(n[o++])},getFont:function(e){var t=this.config,n=e.promise,o=i.url.getQueryValue(location.search,"xiaoduzaixiao");if(1===+o)return n.resolve({ACaslonPro:"Times"}),t.fontMapLoaded=!0,n;var a="wenku_reader_fontCallBack";return t.fontMapLoaded?(n.resolve(t.fontMapping),n):(i.lang.module(a,function(e){i.lang.isObject(e)&&(t.fontMapping=e,t.fontMapLoaded=!0,n.resolve(t.fontMapping))
}),i.sio.callByServer(t.fontMapAPI,a,{timeOut:t.maxWaitingTime,onfailure:function(){t.fontMapLoaded=!0,n.resolve(t.fontMapping)}}),n)},_preloadFontFile:function(e,t){this.mediator.fire("p:fontLoad",{page:t,font:e})},_getPptData:function(e){var t=this,n=r(t.config.pptAPI,{doc_id:t.config.doc_id,pn:e,rn:1,host:this.config.host,token:this.config.token}),o=t._syncCache;o[e]||(o[e]=+new Date,i.sio.callByServer(n,function(n){t.mediator.fire("p:renderView",{data:{page:e,data:n,timeconsume:new Date-o[e]}})
}))}});n.exports.docModel=f});
;define("wkapi:widget/js/reader/model/model.js",function(e,o,d){var n=e("wkapi:widget/js/reader/model/doc/model.js").docModel,i={doc:n},l=function(e,o,d){var n=null;d.on("m:init",function(){n=new i[o.type](o,d)}),d.on("p:dispose",function(){n&&n.dispose(),n=null})};d.exports.ModelList=l});
;define("wkapi:widget/js/reader/view/doc/render.js",function(t,e,r){var i=t("wkapi:widget/js/dep/tangram/base.js"),o=t("wkapi:widget/js/dep/util/util.js"),a="reader-word-s",n=1,p=10,s="reader-word-layer",h="",l=null,u="reader-render-style",f=i.url.getQueryValue(location.search,"fontoverlapfix"),c=function(){return i.browser.firefox?"-moz-":i.browser.chrome||i.browser.safari?"-webkit-":i.browser.ie&&i.browser.ie>8?"-ms-":""}(),x=function(){return i.browser.ie&&i.browser.ie<9?"ie":"other"}(),d=function(t,e,r,i,o,a){var n,p,s,h,l=[],u=2,f=e.v,c=a.picUrl,d=a.fontMapping,w={word:y,pic:M[x]},g={pic:'<div class="reader-pic-layer" style="z-index:__NUM__"><div class="ie-fix">',word:'<div class="reader-txt-layer" style="z-index:__NUM__"><div class="ie-fix">'},v="</div></div>",m=0,b=0;
t.sort(function(t,e){return t.p.z-e.p.z});for(var _=-1,F=t.length;++_<F;)n=t[_],"pic"===n.t&&(m=Math.max(m,n.c.ih+n.c.iy+5),b=Math.max(b,n.c.iw));for(var _=-1,F=t.length;++_<F;)n=t[_],s=n.t,!p&&(p=h=s),p===s?l.push(w[n.t](n,i,r,d,e,f,c,o,m,b,a)):(l.push(v),l.push(g[s].replace(/__NUM__/,u++)),l.push(w[n.t](n,i,r,d,e,f,c,o,m,b,a)),p=s);return g[h].replace(/__NUM__/,1)+l.join("")+v},y=function(t,e,r,o,a,h){var l,u,f=i.string.encodeHTML,c=t.p,d=t.ps,y=t.s,M=w,_=g,F=['<b style="font-family:simsun;">&nbsp</b>',"\n"],j=i.lang.isNumber,z=i.lang.isObject,O=p,P=n,k=v,N=b,T=z(d),U=c.w,X=c.h,S=c.y,q=c.x,I=c.z,A=new RegExp("([\\s\\t\\xa0\\u3000])|([\\u3000\\xa0\\s\\t]$)","g");
return T&&(j(d._opacity)&&1===d._opacity||j(d._alpha)&&0===d._alpha)?"":(l=~~(U*O*P),u=~~(X*O*P),["<p ",'class="'+s+_(t.r,e)+'" ','style="',"width:"+l+"px;","height:"+u+"px;","line-height:"+u+"px;","top:"+~~(S*O*P)+"px;","left:"+~~(q*O*P)+"px;","z-index:"+I+";",M(y,r,o,h),T&&j(d._rotate)&&k[x](d._rotate,U,X,q,S,O,P)||"",T&&j(d._opacity)&&N[x]()||"",T&&j(d._alpha)&&N[x](d._alpha)||"",T&&j(d._scaleX)&&m[x](d._scaleX,l,u)||"",i.lang.isString(t.c)&&1===t.c.length&&t.c.match(A)&&"font-family:simsun;",'">',f(t.c).replace(A,"&nbsp"),T&&j(d._enter)&&F[d._enter]||"","</p>"].join(""))
},w=function(t,e,r,i){var o,a=[],s={"font-size":1},h=p,l=n,u={"font-family":function(t,o){var n=e?e[o]||o:o;a.push("other"===x||+i>5?"font-family:'"+n+"','"+o+"','"+(r.hasOwnProperty(n)&&r[n]||n)+"';":"font-family:'"+o+"','"+n+"','"+(r.hasOwnProperty(n)&&r[n]||n)+"';")},bold:function(t,e){"false"!==e&&a.push(1===+f?"font-weight:400;":"font-weight:600;")},"letter-spacing":function(t,e){a.push("letter-spacing:"+e*p+"px;")}};for(o in t)u[o]?u[o](o,t[o]):a.push(o+":"+(s[o]?~~(t[o]*h*l)+"px":t[o])+";");
return a.join("")},g=function(t){var e=" "+h;return i.lang.isArray(t)&&t.length?e+t.join(e):""},v={ie:function(t,e,r,i,o,a,n){{var p=Math.PI/180,s=t*p,h=Math.sin(s);Math.cos(s)}return["filter:progid:DXImageTransform.Microsoft.Matrix(M11='0', M12='"+-h+"', M21='"+h+"', M22='0', sizingMethod='auto expand');","width:"+r*a*n+"px;","height:"+(e+7)*a*n+"px;"].join("")},other:function(t,e,r,i,o,a,n){var p=[],s=a*n,h={90:function(){p.push("left:"+~~(i+(e-r)/2)*s+"px;"),p.push("top:"+~~(o-(r-e)/2)*s+"px;"),p.push("text-align: right;"),p.push("height:"+~~(r+7)*s+"px;")
},180:function(){p.push("left:"+~~(i-e)*s+"px;"),p.push("top:"+~~(o-r)*s+"px;")},270:function(){p.push("left:"+~~(i+(r-e)/2)*s+"px;"),p.push("top:"+~~(o-(e-r)/2)*s+"px;")}};return h[t](),c+"transform:rotate("+t+"deg);"+p.join("")}},m={ie:function(t,e,r){return"filter: progid:DXImageTransform.Microsoft.Matrix(M11="+t+",M12=0,M21=0,M22=1,SizingMethod='auto expand');width:"+(e+Math.floor(e/2))+"px;height"+(r+Math.floor(r/2))+"px;"},other:function(t,e,r){return c+"transform: scaleX("+t+");"+c+"transform-origin:left top;width:"+(e+Math.floor(e/2))+"px;height:"+(r+Math.floor(r/2))+"px;"
}},b={ie:function(t){return t=t||0,t=100*t,"filter: alpha(opacity="+t+");"},other:function(t){return t=t||0,"opacity:"+t+";"}},M={ie:function(t,e,r,i,o,a,p,s,h,l,u){var f=t.p,c=t.c,x=f.w,d=f.h,y=f.y,w=f.x,g=f.z,v=n,m=_(f,c,o);return+a>5&&f.hasOwnProperty("opacity")&&0===f.opacity?"":['<div style="',"width:"+~~(x*v)+"px;","height:"+~~(d*v)+"px;","top:"+~~(y*v)+"px;","left:"+~~(w*v)+"px;","z-index:"+g+";",'position:absolute;">','<v:image  stroked="false" src="'+p({doc_id:s,version:a,pn:e,ix:w,iy:y,raww:x,rawh:d,o:f.opacity,host:u.host,token:u.token})+'"',m.attr(),' style="'+m.style()+'"></v:image></div>'].join("")
},other:function(t,e,r,i,o,a,n,p,s,h,l){var u=t.p,f=t.c,c=u.w,x=u.h,d=u.y,y=u.x,w=(u.z,[]);return+a>5&&u.hasOwnProperty("opacity")&&0===u.opacity?"":u.hasOwnProperty("x1")||0!==u.rotate&&1!==u.opacity?(w.push("background-image: url("+n({doc_id:p,version:a,pn:e,ix:y,iy:d,raww:c,rawh:x,o:u.opacity,host:l.host,token:l.token})+");"),w.push("background-position:"+-f.ix+"px "+-f.iy+"px;"),w.push("width:"+f.iw+"px;"),w.push("height:"+f.ih+"px;"),w.push(z(u,f)),'<div class="reader-pic-item" style="'+w.join("")+'position:absolute;overflow:hidden;"></div>'):(w.push("width:"+f.iw+"px;"),w.push("height:"+f.ih+"px;"),w.push(z(u,f)),'<p class="reader-pic-item" style="'+w.join("")+'position:absolute;overflow:hidden;"><img width="'+h+'" height="'+s+'" style="position:absolute;top:-'+f.iy+"px;left:-"+f.ix+"px;clip:rect("+f.iy+"px,"+(h-f.ix)+"px, "+s+"px, "+f.ix+'px);" src="'+n({doc_id:p,version:a,pn:e})+'" alt=""></p>')
}},_=function(t,e,r){if(!t)return!1;var o=parseFloat(e.iw),a=parseFloat(e.ih),p=parseFloat(r.iw),s=parseFloat(r.ih),h=(parseFloat(e.ix)/p).toFixed(4),l=(parseFloat(e.iy)/s).toFixed(4),u=(1-o/p-h).toFixed(4),f=(1-a/s-l).toFixed(4),c=i.lang.isNumber;return{style:function(){var e,r=[];return c(t.opacity)&&t.opacity<1&&.01!==t.opacity&&0!==t.opacity&&r.push("filter: alpha(opacity="+100*t.opacity+");"),r.push("width:"+t.w*n+"px;"),r.push("height:"+t.h*n+"px;"),t.w==o&&t.h==a||!t.hasOwnProperty("x1")||(e=F(t.x0,t.y0,t.x1,t.y1,t.x2,t.y2),r.push("width:"+e[0]*n+"px;"),r.push("height:"+e[1]*n+"px;")),t.hasOwnProperty("x1")&&r.push(j[x](Math.abs(t.rotate)>.01?t.rotate:0,t.x1,t.x2,t.y0,t.y1)),r.join("")
},attr:function(){var t=[];return t.push('cropleft="'+h+'"'),t.push('croptop="'+l+'"'),t.push('cropright="'+u+'"'),t.push('cropbottom="'+f+'"')," "+t.join(" ")}}},F=function(t,e,r,i,o,a){var n=Math,p=n.sqrt(n.pow(n.abs(t-r),2)+n.pow(n.abs(e-i),2)).toFixed(4),s=n.sqrt(n.pow(n.abs(r-o),2)+n.pow(n.abs(i-a),2)).toFixed(4);return[s,p]},j={ie:function(t,e,r,i,o){var a=!1,n=!1,p=[],s=!1;return o>i&&(a=!0),e>r&&(n=!0),a?(p.push("flip: y;"),s=!0,n&&p.push("flip:"+(s?"y x":"x")+";")):t&&p.push("rotation:"+t+";"),p.join("")
},other:function(t,e,r,i,o,a){var n=!1,p=!1;return o>i&&(n=!0),e>r&&(p=!0),n&&p?a+=" Matrix(-1,0,0,-1,0,0)":n?a+=" Matrix(1,0,0,-1,0,0)":p?a+=" Matrix(-1,0,0,1,0,0)":t&&(a+=" rotate("+t+"deg)"),a+";"}},z=function(t,e){if(!t)return!1;var r,o,a,p,s=e.iw,h=e.ih,l=n,u=t.x*l+"px",f=t.y*l+"px",x=[],d="",y={},w=i.lang.isNumber,g={opacity:1,rotate:1,z:1};for(p in t)y[p]=!g[p]&&w(t[p])?t[p]*l:t[p];if(y.w!=s||y.h!=h){y.hasOwnProperty("x1")&&(a=F(y.x0,y.y0,y.x1,y.y1,y.x2,y.y2)),r=a?parseFloat(parseFloat(a[0])/s).toFixed(2):parseFloat(y.w/s).toFixed(2),o=a?parseFloat(parseFloat(a[1])/h).toFixed(2):parseFloat(y.h/h).toFixed(2);
var v=s*(r-1),m=h*(o-1);d=c+"transform: scale("+r+","+o+")",y.hasOwnProperty("x1")?(f=(y.y1+y.y3)/2-parseFloat(h)/2+"px",u=(y.x1+y.x3)/2-parseFloat(s)/2+"px"):(f=y.y+m/2+"px",u=y.x+v/2+"px")}return x.push("z-index:"+y.z+";"),x.push("left:"+u+";"),x.push("top:"+f+";"),x.push("opacity:"+(y.opacity||1)+";"),x.push(y.hasOwnProperty("x1")?j.other(Math.abs(y.rotate)>.01?y.rotate:0,y.x1,y.x2,y.y0,y.y1,d):d+";"),x.join("")},O=function(t,e,r,o){var a,n,p,s=[],l=t.length,u=i.string.trim,f=r.fontMapping,c=r._fontList;
for(n=0;l>n;n++)a=t[n],a.s&&(p=u(P(a.s,e,f,r)),p&&s.push("."+h+a.c.join(",."+h)+"{ "+p+"}"),a.s["font-family"]&&(c[a.s["font-family"]]=h+a.c[0]));return s.push("#pageNo-"+o+" .reader-parent{visibility:visible;}"),s.join(" ")},P=function(t,e,r,i){var o,a=[],s=p,h=n,l={"font-size":function(t,e){a.push("font-size:"+~~(e*s*h)+"px;")},"letter-spacing":function(t,e){a.push("letter-spacing:"+e*p+"px;")},bold:function(t,e){"false"!==e&&a.push(1===+f?"font-weight:400;":"font-weight:600;")},"font-family":function(t,o){var n=e?e[o]||o:o;
a.push("other"===x||+i.readerVersion>5?"font-family:'"+n+"','"+o+"','"+(r.hasOwnProperty(n)&&r[n]||n)+"';":"font-family:'"+o+"','"+n+"','"+(r.hasOwnProperty(n)&&r[n]||n)+"';")}};for(o in t)l[o]?l[o](o,t[o]):a.push(o+":"+t[o]+";");return a.join("")},k=function(t,e,r){var p=t.page;if(h=a+e+"-",!i.lang.isArray(t.body))return"";p&&(n=parseFloat(parseFloat(r.pw)/parseFloat(p.pw)).toFixed(4));{var s=o.cssStringManager(u),f=O(t.style,t.font,r,e);r.doc_id_update}return clearTimeout(l),s.register(e,f),s.render(),d(t.body,t.page,t.font,e,r.doc_id_update,r)
};r.exports.compile=k;var N=function(t,e,r,i,o,a){var n="",a=a||"",o=o?o:.93;return null===t?"":(n="ie"===x?"zoom:"+o+";":c+"transform:scale("+o+");"+c+"transform-origin:left top;",['<div class="reader-parent-'+e+" reader-parent "+a+'" style="position:relative;top:0;left:0;'+n+'">','<div class="reader-wrap'+e+'" style="position:absolute;top:0;left:0;width:100%;height:100%;">','<div class="reader-main-'+e+'" style="position:relative;top:0;left:0;width:100%;height:100%;">',t,"</div>","</div>","</div>"].join(""))
};r.exports.render=N;var T=function(t,e){if(t=i.dom.q("reader-parent",t),!t||!i.lang.isElement(t[0]))return!1;if(t=t[0],"ie"===x)i.dom.setStyle(t,"zoom",e);else{var r=c+"transform:scale("+e+");"+c+"transform-origin:0 0;";t.style.cssText+=r}};r.exports.zoom=T});
;define("wkapi:widget/js/reader/view/doc/view.js",function(require,exports,module){var T=require("wkapi:widget/js/dep/tangram/base.js"),util=require("wkapi:widget/js/dep/util/util.js"),V=require("wkapi:widget/js/dep/mvp/view/view.js").View,Render=require("wkapi:widget/js/reader/view/doc/render.js"),render=Render.render,zoom=Render.zoom,sensitiveWords=require("wkapi:widget/misBack/sensitiveWords/sensitiveWords.js"),compile=Render.compile,url=require("wkapi:widget/js/dep/url/url.js"),search=location.search,query=url.queryToJson(search);
try{eval("document.namespaces")}catch(ex){}var View=T.lang.createClass(function(e,t){this._init(e,t)},{superClass:V}).extend({_init:function(e,t){this.config=e,this.mediator=t,this.ns="v",this.zoomLevel=null,this.el=e.container,this.sensitiveWords=null,this.cssStringManager=util.cssStringManager(this.config.cssStringId),T.browser.ie&&T.browser.ie<9&&(this.createVmlNameSpace(this.ns),this.createVmlStyleSheet(this.ns)),this._initEvents()},_initEvents:function(){function e(){var e=i.getCurrentPage(i.config.els)||i.config.pageCount;
return r.fire("p:setCurrentPage",{page:e}),e}var t,i=this,r=this.mediator;2!==parseInt(query.wenkuSmallApp,10)&&T.on(window,"scroll",function(){window.CPU_MONITOR&&CPU_MONITOR.start("scrolling"),r.fire("v:scrolling"),clearTimeout(t),e(),t=setTimeout(function(){window.CPU_MONITOR&&CPU_MONITOR.start("gotoPage");var t=e();r.fire("v:scrolled"),r.fire("p:gotoPage",{page:t}),window.CPU_MONITOR&&CPU_MONITOR.end("gotoPage")},100),window.CPU_MONITOR&&CPU_MONITOR.end("scrolling")}),r.on("v:renderView",T.fn.bind(this.render,this)),r.on("v:getCurrentPage",e),r.on("v:recycleView",T.fn.bind(this._recycleView,this)),r.on("v:recycleStyle",T.fn.bind(this._recycleStyle,this)),r.on("v:zoom",T.fn.bind(this._zoom,this)),r.on("v:loading",T.fn.bind(this._loading,this)),r.on("v:error",T.fn.bind(this._error,this)),r.on("v:cacheRender",T.fn.bind(this._cacheRender,this)),i.on("dispose",function(){i.cssStringManager.removeManager()
})},getCurrentPage:function(e){if(query.pn)return+query.pn;var t=T.page.getScrollTop(),i=T.array.find(e,function(e){return T.dom.getPosition(e).top+e.offsetHeight>t});return T.lang.isElement(i)?T.dom.getAttr(i,"data-page-no"):null},_findEl:function(e){var t,i=this.config.els,r=[];e=T.lang.isArray(e)?e:[e],e=e.slice(0);for(var n=0;n<i.length;n++)t=T.array.indexOf(e,+T.dom.getAttr(i[n],"data-page-no")),t>-1&&(r.push(i[n]),e.splice(t,1));return r.length?r:null},createVmlNameSpace:function(e){try{document.namespaces[e]||document.namespaces.add(e,"urn:schemas-microsoft-com:vml")
}catch(t){}},createVmlStyleSheet:function(e){var t=e+"\\:image{behavior:url(#default#VML);display:block;}";this.cssStringManager.register("vmlCreate",t),this.cssStringManager.render()},_cacheRender:function(e){var t,i=e.data,r=e.page,n=this._findEl(r),a=e.promise;return null===i&&a.resolve(""),n&&n[0]&&(t=compile(i,r,this.config),a.resolve(t)),a},render:function(e){var t,i,r,n,a,o=e.data,s=e.page,d=this._findEl(s),c="",l=this.config.isPPT,g=this.mediator,h=this.config.pw+10;if(d&&d[0]){if(1==T.dom.getAttr(d[0],"data-render"))return!1;
t=T.dom.getAttr(d[0],"data-mate-width"),i=T.dom.getAttr(d[0],"data-mate-height");{new Date}n=parseFloat(+d[0].offsetWidth/this.config.pw).toFixed(2),this.zoomLevel=n,""!==o&&(l&&o.length&&o[0].zoom&&(T.dom.addClass(T.dom.getParent(d[0]),"reader-pptsytle-inner"),r=i*(h/t),a=o[0].zoom.replace(/raww=\d+&/g,"").replace(/rawh=\d+&/g,""),o='<img class="reader-pptstyle" src='+a+' width="'+h+'px" height="'+r+'px"/>'),c=render(o,this.config.doc_id_update,d[0].offsetWidth,d[0].offsetHeight,n,l?"reader-parent-ppt":"")),d[0].innerHTML=c,sensitiveWords.init(d[0],this.config.doc_id_update),T.dom.setAttr(d[0],"data-render","1"),g.fire("p:renderAfter");
var f=d;f&&(f.style.opacity=1)}},_zoom:function(e){var t,i=e.width,r=this.config.els,n=parseFloat(+i/this.config.pw).toFixed(2),a=this.mediator,o=this;this.zoomLevel=n,T.lang.isArray(r)&&(T.array.each(r,function(e){zoom(e,n)}),this.mediator.fire("p:zoomed",{level:n})),t=o.getCurrentPage(o.config.els)||o.config.pageCount,a.fire("p:setCurrentPage",{page:t}),a.fire("v:scrolled"),a.fire("p:gotoPage",{page:t})},_loading:function(e){var t,i=e.pages||[],r=this._findEl(i),n=0,a=this.config.loadingHTML||[];
if(r&&r.length)for(t=r.length;t>n;n++)r[n].innerHTML=a,T.dom.setAttr(r[n],"data-render","")},_error:function(e){var t,i,r=e.page,n=this._findEl(r);if(n)for(t=n.length;t>i;i++)n[i].innerHTML=this.config.errorHTML||"",T.dom.setAttr(n[i],"data-render","")},_recycleView:function(e){var t,i,r=e.pages,n=this.config.els,a=this.mediator;console.log("\u9500\u6bc1ing",e);for(var o=0;o<n.length;o++){t=+T.dom.getAttr(n[o],"data-page-no");var s=T.url.getQueryValue(location.search,"xiaoduzaixiao");T.array.indexOf(r,t)>-1&&1!==+s&&(i=n[o].firstChild,i&&this.removeDom(i),T.dom.setAttr(n[o],"data-render",""),T.dom.setAttr(n[o],"data-page-no",t),a.fire("p:recycleViewed",{page:t}))
}},_recycleStyle:function(e){var t=e.pages;T.array.each(t,function(e){try{T.dom.remove("reader-font-"+e)}catch(t){}})}});module.exports.view=View});
;define("wkapi:widget/js/reader/view/view.js",function(i,e,n){var s=i("wkapi:widget/js/reader/view/doc/view.js").view,t=(i("wkapi:widget/js/dep/tangram/base.js"),i("wkapi:widget/js/dep/util/util.js"),{doc:s}),w=function(i,e,n){var s=null;n.on("v:init",function(){s=new t[e.type](e,n)}),n.on("p:dispose",function(){s&&s.dispose(),s=null})};n.exports.ViewList=w});
;define("wkapi:widget/js/reader/strategy/doc/util.js",function(e,t,n){function i(e){this.winLoaded=!1,this.dataBeforeLoad=[],this.win=e,this.init()}e("wkapi:widget/js/dep/tangram/base.js");i.prototype.init=function(){var e=this,t=function(t){t.source==e.win&&(e.onmessage||function(){}).call(e,t.data)};window.addEventListener?window.addEventListener("message",t,!1):window.attachEvent&&window.attachEvent("onmessage",t)},i.prototype.send=function(e){this.winLoaded?(console.log("aaaaaaaaa"),console.log(this.win.postMessage),this.win.postMessage(e,"*")):this.dataBeforeLoad.push(e)
},i.initInParent=function(e){return new this(e.contentWindow)},i.initInIframe=function(){return new this(window.parent)},!window.postMessage&&window.attachEvent&&(i.prototype.init=function(){var e=!1;try{e=!!this.win.location.href}catch(t){}return e?(this.send=this.sendForSameOrigin,void this.initForSameOrigin()):(this.queue=[],void(window.parent==this.win?this.initForParent():this.initForFrame()))},i.prototype.initForSameOrigin=function(){var e=this;document.attachEvent("ondataavailable",function(t){t.eventType&&"message"===t.eventType&&t.eventSource==e.win&&(e.onmessage||function(){}).call(e,t.eventData)
})},i.prototype.sendForSameOrigin=function(e){var t=this;setTimeout(function(){var n=t.win.document.createEventObject();n.eventType="message",n.eventSource=window,n.eventData=e,t.win.document.fireEvent("ondataavailable",n)})},i.prototype.initForParent=function(){var e=document.createDocumentFragment(),t="width: 1px; height: 1px; position: absolute; left: -999px; top: -999px;",n=document.createElement("iframe");n.style.cssText=t,e.appendChild(n);var i=document.createElement("iframe");i.style.cssText=t,e.appendChild(i),document.body.insertBefore(e,document.body.firstChild),this.senderWin=n.contentWindow,this.receiverWin=i.contentWindow,this.startReceive()
},i.prototype.initForFrame=function(){this.senderWin=null,this.receiverWin=null;var e=this;this.timerId=setInterval(function(){e.waitForFrame()},50)},i.prototype.waitForFrame=function(){var e,t;try{e=this.win[1],t=this.win[0]}catch(n){}e&&t&&(clearInterval(this.timerId),this.senderWin=e,this.receiverWin=t,this.queue.length&&this.flush(),this.startReceive())},i.prototype.startReceive=function(){var e=this;this.timerId=setInterval(function(){e.tryReceive()},50)},i.prototype.tryReceive=function(){try{return void this.receiverWin.name
}catch(e){}this.receiverWin.location.replace("about:blank");var t=this;setTimeout(function(){t.receive()},0)},i.prototype.receive=function(){var e=null;try{e=this.receiverWin.name}catch(t){}if(e){this.receiverWin.name="";for(var n=this,i=e.substring(1).split("|"),o=0;o<i.length;o++)(function(){var e=decodeURIComponent(i[o]);setTimeout(function(){(n.onmessage||function(){}).call(n,e)},0)})()}},i.prototype.send=function(e){this.queue.push(e),this.senderWin&&this.flush()},i.prototype.flush=function(){for(var e=[],t=0;t<this.queue.length;t++)e[t]=encodeURIComponent(this.queue[t]);
var n="|"+e.join("|");try{this.senderWin.name+=n,this.queue.length=0}catch(i){this.senderWin.location.replace("about:blank");var o=this;setTimeout(function(){o.flush()},0)}}),n.exports.Messenger=i});
;define("wkapi:widget/js/reader/strategy/doc/strategy.js",function(e,t,i){var n=e("wkapi:widget/js/dep/tangram/base.js"),r=e("wkapi:widget/js/dep/util/util.js"),a=e("wkapi:widget/js/dep/preload/preload.js").preload,o=e("wkapi:widget/js/reader/strategy/doc/util.js").Messenger,s=e("wkapi:widget/js/dep/log/log.js"),d=e.data,g=function(e,t){if(t.type&&t.doc_id&&t.doc_id_update&&t.els&&t.pw&&t.ph&&t.pageCount&&t.readerVersion||console.error("reader options\u53c2\u6570\u9519\u8bef",t),n.browser.ie&&n.browser.ie<9){this.proxyFrame=document.createElement("iframe"),this.proxyFrame.style.cssText="width:1px;height:1px;position:absolute;top:-9999px;left:-9999px",this.proxyFrame.src=t.proxyApi,this.proxyFrame.id=n.lang.guid(),document.getElementsByTagName("head")[0].appendChild(this.proxyFrame);
var i=this.messenger=o.initInParent(this.proxyFrame),g=this.proxyFrame,f=function(){if(i.winLoaded=!0,g.contentWindow&&g.contentWindow.postMessage)for(var e=0,t=i.dataBeforeLoad.length;t>e;e++)g.contentWindow.postMessage(i.dataBeforeLoad[e],"*")};g.attachEvent?g.attachEvent("onload",f):g.onload=f}this.config._fontList={},this.needViewPages=[],this.currentViewPages=[],this.removeViewTime=null,this.cssStringManager=r.cssStringManager("reader-font-style"),this.cssStringManagerId=this.cssStringManager.getId(),t.cssStringId="reader-other-style",this.linkTag=[],this.fontNum=0,this.fontCache={},this.renderCache={},this.fontLoad=null,this.fontLoadTime=n.browser.ie&&n.browser.ie<8?3e3:1e3,this.prevLoadTime=0,this.currentLoadTime=0,this.prevFontLoadTime=0,this.testSampling=function(){var e,i="sampling-area";
return(e=n.g(i))||(e=document.createElement("div"),e.id=i,document.body.appendChild(e)),e.innerHTML=t.samplingTexts,e.style.fontFamily="",e.style.cssText+=";display : block; position : absolute; top : -9999px; left : -9999px;",e}(),this.samplingSize={width:this.testSampling.offsetWidth,height:this.testSampling.offsetHeight};var c=function(){var e=["chrome","ie","firefox","opera","safari","maxthon"],t=n.array.find(e,function(e){return!!n.browser[e]});return null!==t?"ie"===t?"ie"+n.browser.ie:t:""
}();return r.mix(e,{strategyEvents:function(){var e=this,i=this.mediator;return i.on("p:viewResize",function(t){t.pageHeight&&t.viewHeight&&(e.maxLoadPageNum=e._changeLoadPageNum(t.viewHeight,t.viewHeight))}),i.on("p:renderView",function(i){var r,a=i.data.page,o=i.data.data,d=i.data.timeconsume,g=new Date;e._renderView(o,a),r=+new Date-g,e.log=e.log||s,e.log.send("view","htmlload",{page:a,success:1,time:d,fr:"in",version:t.readerVersion,play:"html",vtime:r,browser:c}),"undefined"==typeof PDC||window.WK_PDC_TTI_FLAG||(PDC.tti(),PDC.mark("fs"),setTimeout(function(){PDC.send&&PDC.send()
},1e3),window.WK_PDC_TTI_FLAG=!0);var f=n.dom.g("pageNo-"+a);f.style.opacity=0}),i.on("p:gotoPage",function(t){var i=+t.page;e.gotoPage(i)}),i.on("p:recycleViewed",function(t){var i=+t.page;n.array.remove(e.currentViewPages,i),e.fire("recycleViewed",{page:i})}),i.on("p:fontLoaded",function(t){var i=t.data;i.file&&e.mediator.fire("v:fontLoad",{file:i.file})}),i.on("p:zoomed",function(t){var i=t.level;e.fire("zoomed",i)}),i.on("p:fontLoad",function(t){var i=t.page,n=t.font;e._loadFontFile(i,n)}),i.on("v:scrolling",function(){clearTimeout(e.removeViewTime)
}),e.on("dispose",function(){for(var t=0;t<e.linkTag.length;t++)n.dom.remove(e.linkTag[t]),e.linkTag[t]=null;e.cssStringManager.removeManager(),n.dom.remove(e.proxyFrame),n.dom.remove("sampling-area")}),n.browser.ie&&n.browser.ie<9&&(e.messenger.onmessage=function(t){e._ieFontStyle(t)}),this},strategyCreate:function(){var e=this,t=e.config.els[0],i=e._isPPT(n.dom.getAttr(t,"data-mate-width"),n.dom.getAttr(t,"data-mate-height"));i?(e.config.isPPT=!0,e.mediator.when(["v:getCurrentPage"]).then(function(){e.fire("created")
})):e.mediator.when(["m:getFont"],["v:getCurrentPage"]).then(function(){e.fire("created")})},hasFont:function(e,t){var i,n,r,a,o,s=this.testSampling,d=(this.samplingSize,s.style);return/^[\u4e00-\u9fff]/.test(t.charAt(0))?(s.innerText=t,d.fontFamily="",i=s.offsetWidth,n=s.offsetHeight,d.fontFamily=e,r=s.offsetWidth,a=s.offsetHeight,o=i!==r||n!==a,d.fontFamily="",o):!1},gotoPage:function(e){var t=this,i=this.mediator,r=this.config,a=this._getDataPage(+e,+r.startPage,+r.pageCount,+r.maxLoadPageNum),o=this.currentViewPages,s=0,d=a.length,g=[];
for(clearTimeout(this.removeViewTime),this.needViewPages=a;d>s;s++)if(this.renderCache[a[s]])-1===n.array.indexOf(o,a[s])&&o.push(a[s]),this.mediator.fire("v:renderView",{data:this.renderCache[a[s]],page:a[s]});else{var f,c=$(".prev-pageList").data("prev-page"),l=$(".next-pageList").data("next-page");f=l?Math.floor(l/50):c?Math.floor(c/50)+1:1,a[s]<=+r.pageCount&&!$('.bd[data-page-no="'+a[s]+'"]').parent().hasClass("reader-page-hide")&&g.push(a[s])}return g.length&&(i.fire("v:loading",{pages:g}),i.fire("m:getData",{pages:g})),this.removeViewTime=setTimeout(function(){t._recycleView(t.needViewPages,t.currentViewPages)
},500),this},_getDataPage:function(e,t,i,r){var a=n.url.getQueryValue(location.search,"smallAppYl");1===+a&&(r=1);var o=Math.floor(r/2),s=[],d=!0,g=e,f=t+i-1,c=f-t+1;if(e>f)return console.error("page \u53c2\u6570\u9519\u8bef"),[];for(1>e-o&&(o=o+(o-e)+1),r>c&&(r=c);r--;)e+o+1>g&&f>=g&&g>0?s.push(g):(d=!1,g=e,r++),d?g++:g--;return s},_changeLoadPageNum:function(e,t){return arguments.length<2||"undefined"==typeof e||"undefined"==typeof e?(console.error("_changeLoadPageNum\u65b9\u6cd5\u53c2\u6570\u9519\u8bef!"),null):Math.ceil(Number(e)/Number(t))
},_renderView:function(e,t){function i(e){a.rendered||(a.rendered=!0,a.fire("firstRender",e)),r.push(e)}var r=this.currentViewPages,a=this;return n.array.indexOf(r,t)>-1?!1:this.config.isPPT?(a.renderCache[t]=e,a.mediator.fire("v:renderView",{data:e,page:t}),i(t),!1):void this.mediator.when(["v:cacheRender",{data:e,page:t}]).then(function(e){a.renderCache[t]=e[0],a.mediator.fire("v:renderView",{data:e[0],page:t}),i(t)})},_invertPages:function(e,t){var i=null,r=e.length;for(t=t.slice(0);r--;)i=n.array.indexOf(t,e[r]),i>-1&&t.splice(i,1);
return t},_recycleView:function(e,t){var i=this._invertPages(e,t);return i.length&&this.mediator.fire("v:recycleView",{pages:i}),this},setZoom:function(e){return this.mediator.fire("v:zoom",{width:e,currentViewPages:this.currentViewPages}),this},_loadFontFile:function(e,t){setTimeout(function(){var t=n.dom.g("pageNo-"+e);t&&(t.style.opacity=1)},500);var i=n.url.getQueryValue(location.search,"xiaoduzaixiao");if(1!==+i){var r=this,o=r.config,s=o.fontAPI,d=0,g={ieeot:function(e,t){var i=0,a=0;console.log(e+" page is loading font "),n.object.each(t,function(t,g){i++;
var f,c,l=r.config._fontList[g];if(l&&(f=n.q(l)[0]),c=n.lang.isElement(f)&&""!==f.innerText?f.innerText:r.config.samplingTexts,d++,r.hasFont(t,c))return a++,void console.log("\u5b57\u4f53 "+t+" \u5b58\u5728\u76f8\u8fd1\u5b57\u4f53");var h=s({doc_id:o.doc_id_update,pn:e,t:"ieeot",rn:1,v:o.readerVersion,ff:g});setTimeout(function(){r.messenger.send(n.json.stringify([g,h]))},1)}),r.log.send("view","fontload",{doc_id:o.doc_id,v:o.readerVersion,count:i,hascount:a,browser:c})},eot:function(e){var t=r.linkTag[r.linkTag.length]=s({doc_id:o.doc_id_update,pn:e,t:"eot",rn:1,v:o.readerVersion});
a(t,function(e){n.page.loadCssFile(e)})},ttf:function(e){var t=r.linkTag[r.linkTag.length]=s({doc_id:o.doc_id_update,pn:e,t:"ttf",rn:1,v:o.readerVersion});console.info("preload ttf",t),t&&a(t,function(e){n.page.loadCssFile(e)})}};if(r.fontCache[e])return!1;r.fontCache[e]=1,n.browser.ie&&n.browser.ie<9?g.ieeot(e,t):n.browser.ie?g.eot(e,t):g.ttf(e,t)}},_ieFontStyle:function(e){if(!e)return!1;e=n.json.parse(e);var t=e[0],i=e[1],r=this;clearTimeout(this.fontLoad),r.cssStringManager.register(t,"@font-face{font-family:'"+t+"';src: url("+i+"); src: url("+i+"#iefix) format('embedded-opentype');}"),this.fontLoad=setTimeout(function(){r.cssStringManager.render()
},500)},_isPPT:function(e,t){var i=(this.config.pptStyle,(e/t).toFixed(2)),n=d.get("WkInfo").DocInfo.docType;return"pdf"!=n?!1:i>1.26?!0:!1}},!0),e};i.exports.strategy=g});
;define("wkapi:widget/js/reader/strategy/strategy.js",function(t,e,a){var s=t("wkapi:widget/js/reader/strategy/doc/strategy.js").strategy,r=(t("wkapi:widget/js/dep/tangram/base.js"),t("wkapi:widget/js/dep/util/util.js"),{doc:s}),i=function(t,e){r[e.type]&&r[e.type].apply(t,arguments)};a.exports.strategy=i});
;define("wkapi:widget/js/reader/presenter/presenter.js",function(e,t,r){var n=e("wkapi:widget/js/dep/tangram/base.js"),i=e("wkapi:widget/js/dep/mvp/presenter/presenter.js").Presenter,s=e("wkapi:widget/js/dep/mvp/event/event.js").custEvent,a=e("wkapi:widget/js/reader/config/config.js").config,o=e("wkapi:widget/js/reader/model/model.js").ModelList,g=e("wkapi:widget/js/reader/view/view.js").ViewList,c=e("wkapi:widget/js/reader/strategy/strategy.js").strategy,u=n.lang.createClass(function(e){this._init(e)
},{superClass:i}).extend({errorNo:["\u6570\u636e\u5f02\u5e38"],_init:function(e){console.log(e);var t=this.config=n.object.extend(n.object.clone(a),e||{}),r=this.mediator=new s;return this.rendered=!1,this.currentPage=Number(t.startPage)||1,c(this,t,r),this._initEvents(),this.strategyEvents&&this.strategyEvents(),o(this,t,r),g(this,t,r),r.when(["m:init",a],["v:init",a]).then(function(){r.when(["m:getFont"])}),this},_initEvents:function(){var t=this,r=this.mediator,i=n.fn.bind;r.on("p:error",i(this._errorCenter,this)),r.on("p:nextPage",i(t.nextPage,t)),r.on("p:prevPage",i(t.prevPage,t)),r.on("p:setCurrentPage",function(e){var r=e.page;
t._changeCurrentPage(r)}),r.on("p:renderAfter",function(){function r(){e.async("wkapi:widget/ui/reader_plugin/reader_plugin.js",function(e){e.plugin(t)})}var i=!1;return function(){!i&&t.config.needPlugins&&(n.browser.ie&&n.browser.ie<8?n.dom.ready(r):r(),i=!0)}}()),t.on("created",function(){var e=Number(t.currentPage)||1;t.gotoPage(e)})},create:function(){{var e=(this.config,this);this.mediator}return this.strategyCreate?this.strategyCreate():e.fire("created"),this},nextPage:function(){var e=this.currentPage+1;
return e<=this.config.pageCount&&this.goToPage(e),this},prevPage:function(){var e=this.currentPage-1;return e>0&&this.goToPage(e),this},getCurrentPage:function(){return this.currentPage||this.config.page},_changeCurrentPage:function(e){e=Number(e),this.currentPage=e,this.fire("filpPage",e)},_errorCenter:function(e){var t=this,r=e.page,n=+e.errno,i=e.errmsg,s={0:function(){t.mediator.fire("v:error",{page:r}),t.log.send("view","htmlload",{page:r,success:0,fr:"in",version:a.readerVersion,play:"html"})
}};s[n]&&s[n](),this.fire("error",i)},setConfig:function(e){return this.config=n.object.extend(this.config,e),this},setZoom:function(){}});r.exports.Presenter=u});
;define("wkapi:widget/js/reader/reader.js",function(e,r,n){var t=e("wkapi:widget/js/reader/presenter/presenter.js").Presenter,s=function(e){return new t(e)};n.exports.reader=s});
;define("wkapi:widget/tpl/doc/lib/util.js",function(i,n){var t=function(i,n){return+n>+i?-1:1};n.asc=t});
;define("wkapi:widget/tpl/doc/lib/factory.js",function(e,t,i){var s=e("wkapi:widget/js/dep/lang/lang.js"),r=e("wkapi:widget/js/reader/reader.js").reader,a=e("wkapi:widget/js/dep/jquery/jquery.js"),n=e("wkapi:widget/js/dep/page/page.js"),o=e("wkapi:widget/tpl/doc/lib/util.js"),g=e("wkapi:widget/js/dep/tangram/base.js"),d=s.createClass(function(e){this.config=e,this.init()},{type:"reader"}).extend({init:function(){var e=this.config;this.$el=a(e.el).eq(0),this.$pages=a(e.pageSelector||".reader-page"),this.pagesOffset=this.getPagesOffset(),this.pageCount=e.pageCount||50,this.ready=new a.Deferred,this.bindEvent(),this.render(),this.dispatchEvent("ready")
},bindEvent:function(){},render:function(){var e=a.extend({type:"doc",els:this.$pages.find(".bd").get(),pw:this.$el.width(),ph:this.$el.height(),zoomLevel:1,container:this.$el,loadingHTML:'<div class="xreader-loading-layer"></div>',errorHTML:'<div class="xreader-error-layer"></div>',needPlugins:!1,startPage:this.config.toPage},this.config);this.xreader=new r(e),this.xreader.create();var t=g.url.getQueryValue(location.search,"wenkuSmallApp");3!==+t&&this.xreader.gotoPage(1)},insert:function(e,t){e<this.pageCount?a(".reader-page-"+(e+1)).before(t):a(".reader-page-"+(e+1)).after(t),this.dispatchEvent("insert"),this.pagesOffset=this.getPagesOffset()
},getCurrentPage:function(){var e=n.getScrollTop();return this.getPageFromOffset(e)},getPageFromOffset:function(e){var t=this.pagesOffset.slice(1),i=t.indexOf(e);return i>-1?i+1:(t.push(e),t.sort(o.asc).indexOf(e)+1)},getReaderOffset:function(){return this.$el.offset()},getPagesOffset:function(){var e=[],t=0,i=this.$pages,s=i.length;for(t;s>t;t++)e.push(i.eq(t).offset().top);return e.sort(o.asc)},gotoPage:function(e){var t=this;e=e-this.config.startPage+1;var i=a(".reader-page-"+e).offset().top;this.xreader.gotoPage(e),window.scrollTo(0,i),setTimeout(function(){t.dispatchEvent("scroll")
},0)},dispose:function(){}});i.exports=d});
;define("wkapi:widget/tpl/doc/readerCreater.js",function(e,n,t){var a,r,i=e("wkapi:widget/tpl/doc/lib/factory.js"),o=e("wkapi:widget/js/dep/jquery/jquery.js"),g=e("wkapi:widget/js/dep/url/url.js"),d=e("wkapi:widget/js/dep/Messenger.js").Messenger,s=e("wkapi:widget/js/dep/tangram/base.js"),l=e("wkapi:widget/js/download/download.js"),p=o(".prev-pageList"),c=o(".next-pageList"),h="",u=location.search,f=e("wkapi:widget/js/setting/setting.js"),w=e("wkapi:widget/js/fullScreen/fullScreen.js"),v=e("wkapi:widget/js/dep/plugin/plugin.js").plugin,m=null;
u&&(h=g.queryToJson(location.href)),p.length&&(a=p.attr("data-prev-page"),h.pn=a,p.on("click",function(){y.send(s.json.stringify({msg:"Xreader.changeIframeSrc",pn:a}))})),c.length&&(r=c.attr("data-next-page"),h.pn=r,c.on("click",function(){y.send(s.json.stringify({msg:"Xreader.changeIframeSrc",pn:r}))}));var y=new d("xreader","wenkuApi");y.listen(function(e){var n={"Api.windowScroll":"windowScroll","Api.ready":"apiReady","Api.download":"download","Api.confirmDownload":"confirmDownload","Api.fullScreen":"apiFullscreen","Api.outFullscreen":"apiOutFullscreen","Api.copy":"apiCopy","Api.loadMore":"loadMore"};
try{e=s.json.parse(e)}catch(t){}s.lang.isObject(e)&&e.hasOwnProperty("msg")&&n[e.msg]&&s.lang.eventCenter.fire(n[e.msg],e)}),y.addTarget(window.parent,"parent"),i.extend({bindEvent:function(){var n=this;n.addEventListener("ready",function(){y.send(s.json.stringify({msg:"Xreader.pageResize",width:o(".reader-container").width(),height:o(".reader-container").height(),totalPageNum:n.config.totalPageNum,pn:o(".reader-page:not(.reader-page-hide)").length,itemHeight:o(".reader-page").height()+6,power:n.config.power,showPageNum:n.config.pageCount||o(".reader-page:not(.reader-page-hide)").length,next50Btn:o(".next-pageList").length,pre50Btn:o(".prev-pageList").length,currentFirstPage:+o(".bd:first").attr("data-page-no"),currentLastPage:+o(".bd:last").attr("data-page-no"),docType:"doc"}))
}),s.lang.eventCenter.on("windowScroll",function(e){var t=e.top;o(".reader-page:not(.reader-page-hide) .bd").each(function(e){var a=o(this),r=0,i=o(".reader-page:not(.reader-page-hide)").length,g=o(".next-pageList").length,d=o(".prev-pageList").length,l=(n.config.totalPageNum,o(".reader-container").height());g&&d?(l-=80,r=40):g?l-=40:d&&(l-=40,r=40);var p,c=l/i;return c*(e+1)+r>t?(p=~~a.attr("data-page-no"),n.xreader.gotoPage(p),y.send(s.json.stringify({msg:"Xreader.currentPage",num:p})),!1):void 0
})});var t=new l({host:this.config.host,token:this.config.token,docId:this.config.doc_id});s.lang.eventCenter.on("download",function(){t.getOrgInfo().done(function(n){if(0===+n.status.code){var t=e.data.get("WkInfo"),a=t.DocInfo;y.send(s.json.stringify({msg:"Xreader.quota",data:{orgInfo:n.data,docInfo:a}}))}})}),s.lang.eventCenter.on("confirmDownload",function(){t.getFile()}),s.lang.eventCenter.addEventListener("InFullScreen.before",function(){n.setScrollOfPage()}),s.lang.eventCenter.addEventListener("OutFullScreen.before",function(){n.setScrollOfPage()
}),s.lang.eventCenter.on("InFullScreen.after",function(){var e=n.pageResize(1);y.send(s.json.stringify({msg:"Xreader.fullHeightResize",height:o(".reader-container").height(),yTop:e}))}),s.lang.eventCenter.addEventListener("OutFullScreen.after",function(){var e=n.pageResize(0);y.send(s.json.stringify({msg:"Xreader.outFullHeightResize",height:o(".reader-container").height(),yTop:e}))}),s.lang.eventCenter.addEventListener("loadMore",function(e){if(0!==o(".reader-page-hide").size()){var t=parseInt(o(".reader-page-hide .bd").eq(0).data("page-no"),10);
o(".reader-page-hide").slice(0,e.rn).removeClass("reader-page-hide"),n.xreader.gotoPage(t),n.dispatchEvent("ready")}}),2===parseInt(h.wenkuSmallApp,10)&&o(".reader-page").on("click",".bd",function(){clearTimeout(m),m=setTimeout(function(){window.wkReady=(new Date).getTime(),y.send(s.json.stringify({msg:"Xreader.clickPage",pn:o(this).data("page-no")}))}.bind(this),100)}),o(".pageList-btn").on("click",function(){var e=o(this).data("prev-page")||o(this).data("next-page");y.send(s.json.stringify({msg:"Xreader.loadNext50Pages",showPageNum:o(".reader-page").length,pn:e}))
});var a=s.url.getQueryValue(location.search,"wenkuSmallApp");if(1===+a){o(".reader-container").css({"padding-bottom":"144px"}),o(".reader-container-bottom").css({display:"block"});var r=s.url.getQueryValue(location.search,"wenkuSmallTip");o(".reader-container-bottom").text("wkDownload"===r?"\u4e0b\u8f7d\u6587\u6863":"\u8bd5\u8bfb\u7684\u6587\u6863,\u4e0b\u8f7d\u67e5\u770b\u5168\u6587")}o(".reader-container-bottom").on("click",function(){window.swan.webView.postMessage({data:{wkAction:"wkXreaderBackClick"}}),window.swan.webView.navigateBack()
});var i=new w;n.$bdHeight=o(".reader-container .bd").length>0?o(".reader-container .bd")[0].style.height:0,s.lang.eventCenter.on("apiFullscreen",function(e,t){n.pageWidth=t.pageWidth,n.pageHeight=t.pageHeight,n.pageScrollTop=t.pageScrollTop,i.toFullscreen(t.pageWidth)}),s.lang.eventCenter.on("apiOutFullscreen",function(e,t){n.pageWidth=t.pageWidth,n.pageHeight=t.pageHeight,n.pageScrollTop=t.pageScrollTop,i.toOutFullscreen(t.pageWidth)}),s.lang.eventCenter.on("apiCopy",function(e,t){v(n,t.copy)})
},pageResize:function(e){var n=this;this.pageList=o(".reader-container .bd");var t,a=n.pageList,r=0,i=a.length,g=n.pageScrollTop,d=n.pageHeight;for(i;i>r;r++){var l=a[r],p=100*+parseFloat(s.dom.getAttr(l,"data-scale")).toFixed(2);"pay-page"!==l.id&&"longdoc-login-page"!==l.id&&(bdW=n.pageWidth,l.style.height=0===e&&l.style.height!==n.$bdHeight?n.$bdHeight:bdW/p*100+"px",l.style.width=bdW+"px",t=bdW)}return n.readerResize({width:t}),now=o(".reader-container").height(),g=g*now/d},setScrollOfPage:function(){this._scrollOfPage=f.currentPage
},readerResize:function(e){var n=this;n.xreader.setZoom(e.width)}}),t.exports=i});